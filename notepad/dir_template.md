# Rmd/targets RNA-seq パイプライン推奨ディレクトリ構造

このテンプレートは、`Rmd-Targets_Rule.md` の原則に従い、`targets` と R Markdown を使用して再現可能な RNA-seq 解析パイプラインを構築するための推奨ディレクトリ構造の概要を示します。

```
your-project-root/
├── _targets.R             # targets パッケージのメインパイプライン定義ファイル
├── _targets/              # targets のメタデータとオブジェクト（キャッシュ）のデフォルトディレクトリ
├── R/                     # R 関数（ユーティリティスクリプト、カスタム解析関数）
│   ├── utils.R            # 一般的なユーティリティ関数
│   └── analysis_functions.R # 特定の解析ヘルパー関数（例）
├── Rmd/                   # R Markdown モジュール（個別の解析ステップ）
│   ├── 01_setup_se.Rmd    # 例: SummarizedExperiment オブジェクトの作成
│   ├── 02_qc_filter.Rmd   # 例: 品質管理とフィルタリング
│   ├── 03_normalization.Rmd # 例: 正規化
│   └── ...                # その他の解析モジュール
├── data/                  # 生データおよび中間データファイル
│   ├── raw/               # オリジナルの生データ（例: カウントマトリックス、メタデータ）
│   └── processed/         # 処理済みデータファイル（targets によって保存されない場合）
├── results/               # 最終出力（プロット、テーブル、レポート）
│   ├── plots/             # プロット用ディレクトリ
│   │   ├── qc/            # QC 関連プロット
│   │   └── diff_expr/     # 発現変動解析関連プロット
│   ├── tables/            # テーブル用ディレクトリ（例: CSV, TSV）
│   │   ├── qc/            # QC サマリーテーブル
│   │   └── diff_expr/     # 発現変動解析結果
│   └── reports/           # レンダリングされた R Markdown レポート（設定されている場合）
├── config/                # 設定ファイル（例: パラメータ用 YAML）
│   └── params.yaml        # パラメータファイルの例
├── docs/                  # 各モジュールの仕様書（例: module_spec_template.md をコピーして使用）
├── tests/                 # R 関数のユニットテスト
│   ├── testthat.R         # テストランナー設定
│   └── test-utils.R       # utils.R のテストファイルの例
├── notepad/               # 仕様書、ルール、メモ
│   ├── Rmd-Targets_Rule.md
│   ├── module_spec_template.md
│   └── dir_template.md    # このファイル
├── renv/                  # renv 環境ファイル（renv 管理）
├── renv.lock              # パッケージバージョンを定義する renv ロックファイル
├── .Rprofile              # R セッション起動スクリプト（例: renv のロード）
├── .gitignore             # Git で無視するファイルとディレクトリ
└── README.md              # プロジェクトの説明、セットアップ手順など
```

## ディレクトリ/ファイルの説明:

*   **`_targets.R`**: `targets` パイプラインを定義するコアスクリプト。ターゲット間の依存関係やコマンド（Rmd モジュール用の `tar_render` など）を含みます。
*   **`_targets/`**: `targets` によって自動生成されるディレクトリ。オブジェクトキャッシュやメタデータを保存します。通常は `.gitignore` に追加されます。
*   **`R/` (または `src/`)**: 異なる Rmd モジュール間や `_targets.R` 内で使用されるカスタム R 関数を格納します。Rmd ファイルを解析ステップに集中させるのに役立ちます。
    *   `utils.R`: 一般的なユーティリティ関数。
    *   `analysis_functions.R`: 特定の解析に固有のヘルパー関数。
*   **`Rmd/` (または `modules/`)**: R Markdown ファイルを格納します。各ファイルは解析パイプラインの個別のステップやモジュール（例: QC、正規化、発現変動解析）を表します。`01_`, `02_` のような接頭辞は一般的な順序を示すのに役立ちますが、実際の実行順序は `_targets.R` で定義されます。
*   **`data/`**: 入力データおよび、場合によっては中間データファイルを格納します。
    *   `raw/`: オリジナルの未加工データファイル（例: カウントマトリックス、メタデータ）を置く場所。
    *   `processed/`: オプション。`targets` キャッシュによって直接管理されない中間データ用。
*   **`results/`**: 解析の最終出力（プロット、テーブル、コンパイルされたレポートなど）を格納します。サブディレクトリは、出力タイプ（plots, tables）や解析ステップ（qc, diff_expr）ごとに整理するのに役立ちます。**重要な点として、`Rmd-Targets_Rule.md` で定義されたファイルパスと命名規則にここで従う必要があります。**
*   **`config/`**: オプション。設定ファイル用のディレクトリ。パイプラインのパラメータを格納する YAML ファイル（`params.yaml`）など。これにより `_targets.R` がよりクリーンになります。
*   **`docs/`**: 各 Rmd モジュールや共通関数の仕様書を格納します。`Rmd-Targets_Rule.md` の「6. モジュール仕様書」で定義される情報を含みます。
*   **`tests/`**: `R/` で定義された関数のユニットテスト（例: `testthat` を使用）を格納します。コアロジックの信頼性を確保するために不可欠です。
*   **`notepad/`**: プロジェクトのドキュメント、仕様書（このテンプレートやルールなど）、メモを格納します。
*   **`renv/`, `renv.lock`, `.Rprofile`**: R 環境を制御し、再現性を確保するために `renv` パッケージによって管理されます。`.Rprofile` にはしばしば `source("renv/activate.R")` が含まれます。
*   **`.gitignore`**: Git が無視すべき、意図的に追跡しないファイル（例: `_targets/`, `renv/`, 機密データ）を指定します。
*   **`README.md`**: プロジェクトの概要、セットアップ方法、パイプラインの実行方法、結果の解釈方法などを記述する不可欠なファイルです。 